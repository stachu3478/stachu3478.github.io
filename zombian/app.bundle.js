!function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=5)}([function(t,e,i){var r=i(1);"string"==typeof r&&(r=[[t.i,r,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(3)(r,s);r.locals&&(t.exports=r.locals)},function(t,e,i){(e=i(2)(!1)).push([t.i,'body {\r\n    text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;\r\n    color: white;\r\n}\r\n\r\ncanvas {\r\n    margin: 0;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    cursor: grab;\r\n    z-index: -1;\r\n}\r\n\r\ncanvas:active {\r\n    cursor: grabbing;\r\n}\r\n\r\n.mobile {\r\n    position: fixed;\r\n    border: 1px white solid;\r\n    background-color: rgba(250, 250, 250, 0.1);\r\n    background-size: cover;\r\n    color: white;\r\n    font-size: 3mm;\r\n    font-family: Verdana, Geneva, Tahoma, sans-serif;\r\n}\r\n\r\n.move-controller, .aim-controller {\r\n    bottom: 0;\r\n    width: 2cm;\r\n    height: 2cm;\r\n}\r\n\r\n.move-controller {\r\n    left: 0;\r\n    border-top-right-radius: 5mm;\r\n    background-image: url("/gui/move_controller.svg");\r\n}\r\n\r\n.aim-controller {\r\n    right: 0;\r\n    border-top-left-radius: 5mm;\r\n    background-image: url("/gui/aim_controller.svg");\r\n}\r\n\r\n.pause-controller {\r\n    background-color: rgba(0, 0, 0, 0.5);\r\n    top: 3mm;\r\n    left: 0;\r\n    width: 1cm;\r\n    height: 1cm;\r\n    border-top-right-radius: 3mm;\r\n    border-bottom-right-radius: 3mm;\r\n    font-weight: bold;\r\n    font-size: 7mm\r\n}',""]),t.exports=e},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",r=t[3];if(!r)return i;if(e&&"function"==typeof btoa){var s=(a=r,o=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),h="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(h," */")),n=r.sources.map((function(t){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(t," */")}));return[i].concat(n).concat([s]).join("\n")}var a,o,h;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,r){"string"==typeof t&&(t=[[null,t,""]]);var s={};if(r)for(var n=0;n<this.length;n++){var a=this[n][0];null!=a&&(s[a]=!0)}for(var o=0;o<t.length;o++){var h=[].concat(t[o]);r&&s[h[0]]||(i&&(h[2]?h[2]="".concat(i," and ").concat(h[2]):h[2]=i),e.push(h))}},e}},function(t,e,i){var r,s,n={},a=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===s&&(s=r.apply(this,arguments)),s}),o=function(t,e){return e?e.querySelector(t):document.querySelector(t)},h=function(t){var e={};return function(t,i){if("function"==typeof t)return t();if(void 0===e[t]){var r=o.call(this,t,i);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}}(),c=null,l=0,u=[],d=i(4);function f(t,e){for(var i=0;i<t.length;i++){var r=t[i],s=n[r.id];if(s){s.refs++;for(var a=0;a<s.parts.length;a++)s.parts[a](r.parts[a]);for(;a<r.parts.length;a++)s.parts.push(w(r.parts[a],e))}else{var o=[];for(a=0;a<r.parts.length;a++)o.push(w(r.parts[a],e));n[r.id]={id:r.id,refs:1,parts:o}}}}function p(t,e){for(var i=[],r={},s=0;s<t.length;s++){var n=t[s],a=e.base?n[0]+e.base:n[0],o={css:n[1],media:n[2],sourceMap:n[3]};r[a]?r[a].parts.push(o):i.push(r[a]={id:a,parts:[o]})}return i}function m(t,e){var i=h(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=u[u.length-1];if("top"===t.insertAt)r?r.nextSibling?i.insertBefore(e,r.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),u.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var s=h(t.insertAt.before,i);i.insertBefore(e,s)}}function g(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=u.indexOf(t);e>=0&&u.splice(e,1)}function y(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var r=function(){0;return i.nc}();r&&(t.attrs.nonce=r)}return v(e,t.attrs),m(t,e),e}function v(t,e){Object.keys(e).forEach((function(i){t.setAttribute(i,e[i])}))}function w(t,e){var i,r,s,n;if(e.transform&&t.css){if(!(n="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=n}if(e.singleton){var a=l++;i=c||(c=y(e)),r=k.bind(null,i,a,!1),s=k.bind(null,i,a,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",v(e,t.attrs),m(t,e),e}(e),r=D.bind(null,i,e),s=function(){g(i),i.href&&URL.revokeObjectURL(i.href)}):(i=y(e),r=M.bind(null,i),s=function(){g(i)});return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else s()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=a()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=p(t,e);return f(i,e),function(t){for(var r=[],s=0;s<i.length;s++){var a=i[s];(o=n[a.id]).refs--,r.push(o)}t&&f(p(t,e),e);for(s=0;s<r.length;s++){var o;if(0===(o=r[s]).refs){for(var h=0;h<o.parts.length;h++)o.parts[h]();delete n[o.id]}}}};var x,b=(x=[],function(t,e){return x[t]=e,x.filter(Boolean).join("\n")});function k(t,e,i,r){var s=i?"":r.css;if(t.styleSheet)t.styleSheet.cssText=b(e,s);else{var n=document.createTextNode(s),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(n,a[e]):t.appendChild(n)}}function M(t,e){var i=e.css,r=e.media;if(r&&t.setAttribute("media",r),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}function D(t,e,i){var r=i.css,s=i.sourceMap,n=void 0===e.convertToAbsoluteUrls&&s;(e.convertToAbsoluteUrls||n)&&(r=d(r)),s&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var a=new Blob([r],{type:"text/css"}),o=t.href;t.href=URL.createObjectURL(a),o&&URL.revokeObjectURL(o)}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,r=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var s,n=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(n)?t:(s=0===n.indexOf("//")?n:0===n.indexOf("/")?i+n:r+n.replace(/^\.\//,""),"url("+JSON.stringify(s)+")")}))}},function(t,e,i){"use strict";i.r(e);const r=document.getElementsByClassName("move-controller")[0],s={aimDirection:0};window.requestFullScreen=window.requestFullScreen||window.webkitRequestFullScreen||window.mozRequestFullScreen;let n=!1;if(navigator.maxTouchPoints){const t={identifier:-1};let e=t,i=t,a=t,o=t,h=!0;const c=document.getElementsByClassName("move-controller")[0],l=document.getElementsByClassName("aim-controller")[0],u=document.getElementsByClassName("pause-controller")[0];document.body.addEventListener("touchstart",t=>{let r=!1,d=!1,f=!0;n||(n=!0,window.requestFullScreen());for(let n=0;n<t.changedTouches.length;n++){const p=t.changedTouches[n];switch(p.target){case c:if(!r)break;r=!0,e=p,s.ArrowRight=0,s.ArrowLeft=0,s.ArrowDown=0,s.ArrowUp=0;break;case l:if(!d)break;d=!0,i=p,h=!0;break;case u:a=p;break;default:o=p,f=!1}}f&&t.preventDefault()},{passive:!1}),document.body.addEventListener("touchmove",t=>{let n=!0;for(let a=0;a<t.changedTouches.length;a++){const c=t.changedTouches[a];switch(c.identifier){case e.identifier:{const t=c.clientX-e.clientX,i=c.clientY-e.clientY,n=Math.atan2(i,t);let a=2*(Math.hypot(t,i)/(r.offsetWidth>>1));a>1&&(a=1);const o=Math.cos(n)*a,h=Math.sin(n)*a;s.ArrowRight=0,s.ArrowLeft=0,s.ArrowDown=0,s.ArrowUp=0,o>0?s.ArrowRight=o:s.ArrowLeft=-o,h>0?s.ArrowDown=h:s.ArrowUp=-h}break;case i.identifier:h=!1,s.aimDirection=Math.atan2(c.clientY-i.clientY,c.clientX-i.clientX);break;case o.identifier:n=!1}}n&&t.preventDefault()},{passive:!1}),document.body.addEventListener("touchend",r=>{let n=!0;for(let c=0;c<r.changedTouches.length;c++){switch(r.changedTouches[c].identifier){case e.identifier:s.ArrowRight=0,s.ArrowLeft=0,s.ArrowDown=0,s.ArrowUp=0,e=t;break;case i.identifier:s.SpaceBar=!1,i=t,h&&(s.Mouse=!0);break;case a.identifier:a=t,s.p=!0;break;case o.identifier:o=t,n=!1}}n&&r.preventDefault()},{passive:!1}),document.body.addEventListener("touchcancel",r=>{let n=!1,a=!1;for(let t=0;t<r.touches.length;t++){switch(r.touches[t].identifier){case e.identifier:n=!0;break;case i.identifier:a=!0}}n||(s.ArrowRight=0,s.ArrowLeft=0,s.ArrowDown=0,s.ArrowUp=0,e=t),a||(s.SpaceBar=!1,i=t)})}else document.body.addEventListener("keydown",t=>{s[t.key]=!0}),document.body.addEventListener("keyup",t=>{s[t.key]=!1}),document.body.addEventListener("mousemove",t=>{s.aimX=t.offsetX,s.aimY=t.offsetY}),document.body.addEventListener("mousedown",t=>{s.Mouse=!0});var a=class{constructor(t=document.createElement("canvas"),e=0,i=0,r=-100,s=100,n=-100,a=100){this.clipMinX=r,this.clipMaxX=s,this.clipMinY=n,this.clipMaxY=a,this.x=e,this.y=i,this.canvas=t}processScroll(t){let e=0,i=0;return t.w||t.ArrowUp?i=-8:(t.s||t.ArrowDown)&&(i=8),t.d||t.ArrowRight?e=8:(t.a||t.ArrowLeft)&&(e=-8),this.scrollBy(e,i)}scrollBy(t,e){const i=this.x,r=this.y;return this.x+=t,this.y+=e,this.valiScroll(),{x:this.x-i,y:this.y-r}}scrollTo(t,e,i=!1){this.x=t-(i&&this.canvas.width>>1),this.y=e-(i&&this.canvas.height>>1),this.valiScroll()}valiScroll(){this.x<this.clipMinX?this.x=this.clipMinX:this.x>this.clipMaxX-this.canvas.width&&(this.x=this.clipMaxX-this.canvas.width),this.y<this.clipMinY?this.y=this.clipMinY:this.y>this.clipMaxY-this.canvas.height&&(this.y=this.clipMaxY-this.canvas.height)}clip(t,e){this.clipMinX>t&&(this.clipMinX=t),this.clipMinY>e&&(this.clipMinY=e),this.clipMaxX<t&&(this.clipMaxX=t),this.clipMaxY<e&&(this.clipMaxY=e)}clearClip(){this.clipMinX=this.clipMinY=1/0,this.clipMaxX=this.clipMaxY=-1/0}};var o=class{constructor(t,e,i){this.camera=t,this.ctx=e,this.tileMap=i,this.x=0,this.y=0,this.checkPos=this.checkPos.bind(this),this.squareSize=24,this.step=0}moveBy(t,e){return this.unclaimBlock(),this.checkPos(this.x+t,this.y+e,!0)&&this.loopMyPixels(this.checkPos,this.x+t,this.y+e)?(this.x+=t,this.y+=e,this.claimBlock(),this.step+=Math.hypot(t,e),!0):(this.claimBlock(),!1)}checkPos(t,e,i){const r=this.tileMap.getBlock(t,e);if(!r||r.c&&i)return console.log("isTarget"),!1;if(r.c){const t=r.c;if(Math.abs(t.x-this.x)<this.squareSize&&Math.abs(t.y-this.y)<this.squareSize)return this.knock(t,2),!1}return!0}unclaimBlock(t=this.x,e=this.y){return this.tileMap.setBlock(t,e,{c:!1}),!0}claimBlock(t=this.x,e=this.y){return this.tileMap.setBlock(t,e,{c:this}),!0}loopMyPixels(t,e=this.x,i=this.y){for(let r=-32;r<=32;r+=32)for(let s=-32;s<=32;s+=32)if(!t(e+r,i+s))return!1;return!0}knock(t,e){const i=Math.atan2(t.y-this.y,t.x-this.x);t.moveBy(Math.cos(i)*e,Math.sin(i)*e)}renderBottom(){const t=this.step%48,{ctx:e}=this;e.lineWidth=8,e.lineCap="round",e.strokeStyle="navy",e.beginPath(),e.moveTo(0,-4),e.lineTo(t<24?12-t:-36+t,-4),e.stroke(),e.beginPath(),e.moveTo(0,4),e.lineTo(t<24?-12+t:36-t,4),e.stroke()}};const h=new Image(24,24);h.src="mob/hero.svg";const c=new Image(24,24);c.src="mob/zombie1.svg";var l=class extends o{constructor(t,e,i,r){super(e,i,r),this.hp=100,this.kills=0,this.reloaded=!0,this.keyboard=t,this.alive=!0,this.xDir=0,this.yDir=1,this.hpOut=document.getElementById("hero-hp"),this.killsOut=document.getElementById("hero-kills"),this.reloadOut=document.getElementById("hero-reload"),this.checkPos=this.checkPos.bind(this),this.claimBlock()}tick(){const{ArrowRight:t=0,ArrowLeft:e=0,ArrowUp:i=0,ArrowDown:r=0,SpaceBar:s=0,aimDirection:n,aimX:a=0,aimY:o=0}=this.keyboard,h=n||Math.atan2(-this.y+this.camera.y+o,-this.x+this.camera.x+a);this.xDir=Math.cos(h),this.yDir=Math.sin(h);const c=t-e,l=r-i;(c||l)&&this.alive&&this.moveBy(c*Math.abs(3*c+this.xDir),l*Math.abs(3*l+this.yDir)),this.keyboard.Mouse&&(this.attack(),this.keyboard.Mouse=!1),this.camera.scrollTo(this.x,this.y,!0),this.render()}render(){this.ctx.save(),this.ctx.translate(this.x-this.camera.x,this.y-this.camera.y),this.ctx.rotate(Math.atan2(this.yDir,this.xDir)),this.renderBottom(),this.ctx.drawImage(this.alive?h:c,-12,-12),this.ctx.restore()}attack(){if(!this.reloaded||!this.alive)return!1;const t=this.x+32*this.xDir,e=this.y+32*this.yDir;this.ctx.fillStyle="yellow",this.ctx.fillRect(t-8-this.camera.x,e-8-this.camera.y,16,16),this.reloaded=!1,this.reloadOut.innerText="Reloading...",setTimeout(()=>{this.reloaded=!0,this.alive&&(this.reloadOut.innerText="Ready")},400);for(let i=-8;i<=8;i+=16)for(let r=-8;r<=8;r+=16){const s=this.tileMap.getBlock(t+i,e+r);if(s&&s.c&&s.c.intelligence){const t=s.c;return t.hp-=10,this.knock(t,6),t.target=this,t.intelligence>=.125&&t.aim(this.x,this.y),t.hp<=0&&(t.die(),this.kills++,this.killsOut.innerText=this.kills),!0}}return!1}deal(t){if(!this.alive)return!1;this.hp-=t,this.hpOut.innerText=this.hp,this.hp<=0&&(this.alive=!1,this.reloadOut.innerText="Dead")}};const u=document.createElement("canvas"),d=u.getContext("2d");let f=0,p=0,m=()=>{};const g=new Array(4).fill(1),y=(new Array(4).fill(1).map((t,e)=>{const i=new Image(24,24);return p++,i.onload=()=>{g[e]=(t=>{u.width=t.width,u.height=t.height,d.clearRect(0,0,t.width,t.height),d.drawImage(t,0,0);const e=new Image;return e.src=u.toDataURL(),e})(i),f++,f===p&&m()},i.src="mob/zombie"+(e+1)+".svg",i}),2*Math.PI);var v=class extends o{constructor(t,e,i,r){super(t,e,i),this.hp=100,this.spawned=!1,this.intelligence=r,this.inv=1-this.intelligence,this.image=g[Math.floor(4*this.inv)],this.xDir=0,this.yDir=1,this.checkPos=this.checkPos.bind(this),this.spawn()}spawn(){switch(4*Math.random()>>0){case 0:this.x=-600,this.y=1260*Math.random()-620;break;case 1:this.x=600,this.y=1260*Math.random()-620;break;case 2:this.y=-620,this.x=1260*Math.random()-620;break;default:this.y=620,this.x=1260*Math.random()-620}return!!this.checkPos(this.x,this.y)&&(this.claimBlock(),this.spawned=!0,this.changeDir(),!0)}tick(){if(!this.spawned)return this.spawn();if(Math.hypot(this.x-this.targetX,this.y-this.targetY)<=8&&this.changeDir(),this.currentDir!==this.targetDir){let t=this.currentDir-this.targetDir;t>.125?this.currentDir-=.125:t<-.125?this.currentDir+=.125:this.currentDir=this.targetDir,this.xDir=Math.cos(this.currentDir),this.yDir=Math.sin(this.currentDir)}else this.moveBy(this.xDir,this.yDir)||this.changeDir();this.render()}changeDir(){const t=640*Math.random()-320,e=640*Math.random()-320;this.target?(this.targetX=t*this.inv+this.target.x*this.intelligence,this.targetY=e*this.inv+this.target.y*this.intelligence):(this.searchForTarget(),this.targetX=t,this.targetY=e),this.aim(this.targetX,this.targetY)}aim(t=this.targetX,e=this.targetY){this.targetX=t,this.targetY=e,this.targetDir=Math.atan2(e-this.y,t-this.x),this.currentDir=Math.atan2(this.yDir,this.xDir);let i=this.currentDir-this.targetDir;for(;i>Math.PI;)i-=y,this.targetDir-=y;for(;i<-Math.PI;)i+=y,this.targetDir+=y}searchForTarget(){const t=this.x+320*Math.random()-160,e=this.y+320*Math.random()-160,i=this.tileMap.getBlock(t,e);i&&i.c&&i.c.keyboard&&(this.target=i.c)}render(){this.ctx.save(),this.ctx.translate(this.x-this.camera.x,this.y-this.camera.y),this.ctx.rotate(Math.atan2(this.yDir,this.xDir)),this.renderBottom(),this.ctx.drawImage(this.image,-12,-12),this.ctx.restore()}die(){}checkPos(t,e,i){const r=this.tileMap.getBlock(t,e);if(!r||r.c&&i)return!1;if(r.c){const t=r.c;if(this===t)return!1;if(Math.abs(t.x-this.x)<24&&Math.abs(t.y-this.y)<24)return t.keyboard?(t.deal(10),this.knock(t,12)):this.knock(t,2),!1}return!0}};const w=[(t,e,i,r)=>[t*t-e*e+1.63*i,e*t*2.5+1.63*Math.abs(r)],(t,e,i,r)=>[t*t-e*e+t,e*t*2+e],(t,e,i,r)=>[t*t+e*e-t,-e*t*2-e],(t,e,i,r)=>[t*t-e*e-t,-e*t*2-e],(t,e,i,r)=>[t*t-e*e-t,e*t*2-e],(t,e,i,r)=>[t*t-e*e+t,-e*t*2+e],(t,e,i,r)=>[t*t-e*e+t,2*-(e+t)+e],(t,e,i,r)=>[t*t-e*e+i,2*-(e+t)+r],(t,e,i,r)=>[t*t-e*e-t,2*-(e+t)-e],(t,e,i,r)=>[t*t+e*e+i,-Math.hypot(t,e)+r]],x=(t,e,i=255)=>{let[r,s]=[t,e];for(let n=0;n<i;n++){if(r>2||r<-2)return n;[r,s]=b(r,s,t,e)}return i};let b=w[0];const k={};["water","salt","sand","gravel","dirt","grass","dust","stone","miasma"].forEach(t=>{k[t]=new Image,k[t].src="tiles/"+t+".png"});const M=(t,e)=>t-Math.floor(t/e)*e,D=1/65525;let A=0;var B=class{constructor(t,e,i,r=!0){r&&(e.width=window.innerWidth,e.height=window.innerHeight),this.canvas=e,this.camera=t||new a(e),this.ctx=i||e.getContext("2d"),this.camera.x=-829952,this.camera.y=225984}render(t){const{canvas:e,ctx:i}=this,r=(this.camera.x-829952)/32,s=(this.camera.y+225984)/32;let n=0;i.clearRect(0,0,e.width,e.height),e.width=window.innerWidth,e.height=window.innerHeight,i.restore(),i.translate(-32*M(r,1),-32*M(s,1));for(let a=Math.floor(r)*D,o=0;o<e.width+32;a+=D,o+=32)for(let r=Math.floor(s)*D,h=0;h<e.height+32;r+=D,h+=32){const e=x(a,r,t);if(t){if(e==t-1){n++;continue}return n>A&&(console.log("beat",n),A=n),!1}let s="miasma";e<66?s="water":67==e?s="salt":68==e?s="sand":69==e?s="gravel":70==e?s="dirt":71==e?s="grass":e<100?s="dust":e<256&&(s="stone"),i.drawImage(k[s],o,h)}return i.translate(32*M(r,1),32*M(s,1)),!0}};var T=class{constructor(t){this.sizeX=40,this.sizeY=40,this.map=new Array(1600).fill({})}getBlock(t,e){const i=(t+640)/32<<0,r=(e+640)/32<<0;if(i>-1&&i<41&&r>-1&&r<41)return this.map[40*i+r]}setBlock(t,e,i){const r=(t+640)/32<<0,s=(e+640)/32<<0;if(r>-1&&r<40&&s>-1&&s<40){const t=40*r+s;if(this.map[t].c&&i.c)throw console.log(this.map[t].c,i.c),new Error("Write to existing entity position");this.map[t]={...this.map[t],...i}}return!0}};var E=class{constructor(t,e,i){this.canvas=t,this.camera=i||new a(t,0,0,-640,640,-640,640),this.keyboard=e,this.ctx=t.getContext("2d"),this.renderer=new B(this.camera,this.canvas,this.ctx),this.tileMap=new T,this.hero=new l(e,this.camera,this.ctx,this.tileMap),this.paused=!1,this.enemies=new Set,this.spawnedEnemies=1,this.gameTime=1}start(){this.spawnEnemy(),this.wave(),this.loop=setInterval(()=>{this.tick()},30)}tick(){if(this.keyboard.p&&(this.keyboard.p=!1,this.paused=!this.paused,this.paused&&(this.ctx.fillStyle="rgba(0,0,0,0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.font="2cm Consolas",this.ctx.fillText("Paused",this.canvas.width>>1,this.canvas.height>>1),this.ctx.strokeText("Paused",this.canvas.width>>1,this.canvas.height>>1))),!this.paused){this.renderer.render();for(let t of this.enemies.values())t.tick();return this.hero.tick()}}spawnEnemy(){const t=new v(this.camera,this.ctx,this.tileMap,Math.random());this.enemies.add(t),t.die=()=>{t.unclaimBlock(),this.enemies.delete(t)}}wave(){const t=(6e4+this.spawnedEnemies)/this.spawnedEnemies;console.log("Next enemy will appear in ",t>>10," seconds"),setTimeout(()=>{this.spawnEnemy(),this.gameTime+=t,this.spawnedEnemies++,this.hero.alive&&this.wave()},t)}};i(0);!function(){const t=document.getElementsByTagName("canvas")[0],e=new E(t,s);new Promise(t=>{f===p&&0!==p&&t(),m=t}).then(()=>{e.start()})}()}]);