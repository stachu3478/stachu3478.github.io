"use strict";(self.webpackChunkomrat_client=self.webpackChunkomrat_client||[]).push([[189],{9966:(t,n,e)=>{e.r(n),e.d(n,{default:()=>ct});var o,i=e(9755),a=e.n(i),r=e(7268),s=e(9734),c=e.n(s);!function(t){t.CURSOR="cursor",t.MARK="mark",t.GROUP="group"}(o||(o={}));const l=function(){function t(t){this.arrowSize=0,this.arrowDashSize=0,this.defaultLineWidth=0,this.ctx=t,this.params={width:0,height:0,zoom:1,scrollX:0,scrollY:0,mode:o.CURSOR,pointerX:0,pointerY:0}}return t.prototype.start=function(){var t=this.params,n=t.width,e=t.height,o=t.zoom,i=t.scrollX,a=t.scrollY;this.ctx.clearRect(0,0,n,e),this.ctx.scale(o,o),this.ctx.translate(-i,-a),this.ctx.font="".concat(12/this.params.zoom,"px ").concat("Verdana, sans-serif"),this.arrowSize=20/this.params.zoom,this.arrowDashSize=10/this.params.zoom,this.defaultLineWidth=2/this.params.zoom},t.prototype.drawImage=function(t){this.ctx.drawImage(t,0,0)},t.prototype.drawObjects=function(t){var n=this;this.ctx.lineWidth=this.defaultLineWidth,t.eachObject((function(t){n.ctx.strokeStyle=t.klass.color,n.ctx.strokeRect(t.x,t.y,t.width,t.height)}))},t.prototype.drawRelations=function(t){var n=this;this.ctx.lineWidth=this.defaultLineWidth;var e=this.arrowSize;t.eachRelation((function(t){n.drawRelation(t,!0,e)}))},t.prototype.drawFocusedObject=function(t){var n=this.params.zoom;this.ctx.fillStyle="".concat(t.klass.color,"40"),this.ctx.fillRect(t.x,t.y,t.width,t.height);var e=this.ctx.measureText(t.klass.title).width;this.ctx.fillStyle="black",this.ctx.fillRect(t.x,t.y,e+6/n,18/n),this.ctx.fillStyle="white",this.ctx.strokeStyle="white",this.ctx.textBaseline="hanging",this.ctx.fillText(t.klass.title,t.x+3/n,t.y+3/n)},t.prototype.drawSelectedObject=function(t){var n=this.params.zoom;this.ctx.strokeStyle=t.klass.color,this.ctx.lineWidth=5/n,this.ctx.strokeRect(t.x,t.y,t.width,t.height),this.ctx.fillStyle="".concat(t.klass.color,"40"),this.ctx.fillRect(t.x,t.y,t.width,t.height)},t.prototype.end=function(){this.ctx.resetTransform()},t.prototype.drawRelation=function(t,n,e){void 0===n&&(n=!0),void 0===e&&(e=this.arrowSize);var o=t.input.centerPixelX,i=t.input.centerPixelY;this.drawArrow(o,i,t.output.centerPixelX,t.output.centerPixelY,t.klass.color,!n,e)},t.prototype.drawArrow=function(t,n,e,o,i,a,r){this.ctx.strokeStyle=i;var s=this.ctx.getTransform(),c=Math.atan2(o-n,e-t),l=Math.hypot(o-n,e-t),u=r||this.arrowSize;a?this.ctx.setLineDash([this.arrowDashSize]):this.ctx.setLineDash([]),this.ctx.translate(e,o),this.ctx.rotate(c-Math.PI/2),this.ctx.beginPath(),this.ctx.moveTo(0,-l),this.ctx.lineTo(0,0),this.ctx.lineTo(-u,-u),this.ctx.lineTo(0,0),this.ctx.lineTo(u,-u),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.setTransform(s)},t.prototype.drawRelationAbsence=function(t,n){var e=this.ctx.measureText("X").width,o=this.ctx.getTransform();this.ctx.translate(t-5*e/2,n),this.ctx.scale(5,5),this.ctx.textBaseline="middle",this.ctx.fillStyle="red",this.ctx.fillText("X",0,0),this.ctx.setTransform(o)},t}();var u=e(9564),h=e(9537);const p=function(){function t(t,n){this.image=n,this.renderer=new l(t),this.annotationCollection=new h.Z(n.title),this.annotationCollection.dimensions={width:this.image.width,height:this.image.height}}return t.prototype.clear=function(){this.collection.clear(),delete this.selected,delete this.focusedObject},t.prototype.render=function(t){if(this.renderer.params=t,this.renderer.start(),this.renderer.drawImage(this.image),this.renderer.drawObjects(this.collection),this.renderer.drawRelations(this.collection),this.focusedObject&&this.renderer.drawFocusedObject(this.focusedObject),this.selectedObject&&this.renderer.drawSelectedObject(this.selectedObject),t.mode===o.GROUP&&this.selectedObject){var n=t.relationClass;if(!n)return;if(this.focusedObject)this.collection.hasRelation(n,this.selectedObject,this.focusedObject)?this.renderer.drawRelationAbsence(this.focusedObject.centerPixelX,this.focusedObject.centerPixelY):this.renderer.drawRelation(new u.Z(n,this.selectedObject,this.focusedObject),!1);else{var e=this.selectedObject.centerPixelX,i=this.selectedObject.centerPixelY;this.renderer.drawArrow(e,i,t.pointerX,t.pointerY,n.color,!0)}}this.renderer.end()},t.prototype.removeAnnotation=function(t){this.collection.removeAnnotation(t),this.selected===t&&(this.selectedObject=void 0)},Object.defineProperty(t.prototype,"collection",{get:function(){return this.annotationCollection},set:function(t){this.annotationCollection=t,this.annotationCollection.dimensions={width:this.image.width,height:this.image.height}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"annotatedImage",{get:function(){return this.image},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectedObject",{get:function(){return this.selected},set:function(t){this.selected=t,t?(a()(".object-properties").show(),a()(".object-properties .object-name").text(t.klass.title)):a()(".object-properties").hide()},enumerable:!1,configurable:!0}),t}();var f,d=e(6480),v=(f=function(t,n){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},f(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}f(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}),m=function(){return m=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},m.apply(this,arguments)};const y=function(t){function n(n){var e=t.call(this)||this;e.scrollX=0,e.scrollY=0,e.zoom=1,e.pageImages=[],e.currentPageId=0,e.pagesCollection=[],e.navigationParams={mode:o.CURSOR,pointerX:0,pointerY:0};var i=n.get(0);if(!i)throw new Error("HTMLCanvasElement is missing");e.canvas=i;var a=i.getContext("2d");if(!a)throw new Error("HTMLCanvasElement context is missing");return e.ctx=a,e.images=[],e}return v(n,t),n.prototype.render=function(t){void 0===t&&(t={});var n=this.currentPage;this.navigationParams=Object.assign(this.navigationParams,t),n&&n.render(m({width:this.canvas.width,height:this.canvas.height,zoom:this.zoom,scrollX:this.scrollX,scrollY:this.scrollY},this.navigationParams))},Object.defineProperty(n.prototype,"images",{get:function(){return this.pageImages},set:function(t){var n=this;this.pageImages=t,this.pagesCollection=t.map((function(t){return new p(n.ctx,t)})),t.length?(this.imageId=this.currentPageId,a()(".total-images-count").text(t.length.toString()),a()(".pagination").show()):a()(".pagination").hide(),this.scrollX=0,this.scrollY=0,this.emit("images")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"annotations",{set:function(t){var n=this;t.forEach((function(t){var e=n.pagesCollection.find((function(n){return n.annotatedImage.title===t.imageTitle}));e&&(e.collection=t)})),this.render()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"imageId",{get:function(){return this.currentPageId},set:function(t){this.pagesCollection.length&&(this.currentPageId=t%this.pagesCollection.length,this.currentPageId<0&&(this.currentPageId+=this.pagesCollection.length),a()(".current-image-id").text((this.currentPageId+1).toString()),a()(".image-title").text(this.currentPage.annotatedImage.title),this.emit("imagechange"),this.render())},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"element",{get:function(){return this.canvas.parentElement},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"plane",{get:function(){return this.canvas},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentPage",{get:function(){return this.pagesCollection[this.currentPageId]},enumerable:!1,configurable:!0}),n}(d.Z);var g=e(7012);function b(t){return t.composedPath().every((function(t){var n=t;return"ASIDE"!==n.tagName&&"NAV"!==n.tagName}))}const w=function(t){this.annotationCanvas=t};var C=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const O=function(t){function n(n){var e=t.call(this,n)||this;return e.down=e.down.bind(e),e.up=e.up.bind(e),e.scroll=e.scroll.bind(e),e}return C(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("mousedown",this.down)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("mousedown",this.down)},n.prototype.down=function(t){var n;b(t)&&(this.clickedObject=null===(n=this.annotationCanvas.currentPage)||void 0===n?void 0:n.focusedObject,this.annotationCanvas.element.addEventListener("mousemove",this.scroll),this.annotationCanvas.element.addEventListener("mouseup",this.up))},n.prototype.scroll=function(t){this.clickedObject&&(this.clickedObject.x+=t.movementX/this.annotationCanvas.zoom,this.clickedObject.y+=t.movementY/this.annotationCanvas.zoom,this.annotationCanvas.render())},n.prototype.up=function(){this.annotationCanvas.element.removeEventListener("mousemove",this.scroll),this.annotationCanvas.element.removeEventListener("mouseup",this.up),this.clickedObject&&g.Z.instance.check(13)},n}(w);var j=e(19);function _(t,n){t.forEach((function(t){var e=document.createElement("option");e.innerText=t.title,e.value=t.id.toString(),n.append(e)}))}var P=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),x=function(){return g.Z.instance.check(8)};const k=function(t){function n(n){var e=t.call(this,n)||this;return e.labelSelect=a()(".annotation-label-select").get(0),e.down=e.down.bind(e),e.up=e.up.bind(e),e.scroll=e.scroll.bind(e),_(j.s,e.labelSelect),e}return P(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("mousedown",this.down),a()(".mark-properties").show(),a()(document.body).addClass("aiming"),this.labelSelect.addEventListener("change",x)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("mousedown",this.down),a()(".mark-properties").hide(),a()(document.body).removeClass("aiming"),this.labelSelect.removeEventListener("change",x)},n.prototype.down=function(t){if(b(t)){var n=this.annotationCanvas.currentPage;n&&(this.annotation=n.collection.createAnnotationObject(this.currentClass),this.annotation.x=this.cursorToCanvasX(t),this.annotation.y=this.cursorToCanvasY(t),this.annotationCanvas.element.addEventListener("mousemove",this.scroll),this.annotationCanvas.element.addEventListener("mouseup",this.up))}},n.prototype.scroll=function(t){if(this.annotation){var n=this.cursorToCanvasX(t)-this.annotation.x||1,e=this.cursorToCanvasY(t)-this.annotation.y||1;if(t.ctrlKey){var o=Math.max(Math.abs(n),Math.abs(e));this.annotation.width=(n>0?1:-1)*o,this.annotation.height=(e>0?1:-1)*o}else this.annotation.width=n,this.annotation.height=e;this.annotationCanvas.render()}},n.prototype.up=function(){this.annotationCanvas.element.removeEventListener("mousemove",this.scroll),this.annotationCanvas.element.removeEventListener("mouseup",this.up);var t=this.annotationCanvas.currentPage;this.annotation&&(this.annotation.absolutizeDimensions(),g.Z.instance.check(9)),t&&(t.selectedObject=this.annotation,this.annotationCanvas.render())},Object.defineProperty(n.prototype,"currentClass",{get:function(){return j.s[parseInt(this.labelSelect.value,10)]},enumerable:!1,configurable:!0}),n.prototype.cursorToCanvasX=function(t){return t.pageX/this.annotationCanvas.zoom+this.annotationCanvas.scrollX},n.prototype.cursorToCanvasY=function(t){return t.pageY/this.annotationCanvas.zoom+this.annotationCanvas.scrollY},n}(w);var E=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const L=function(t){function n(n){var e=t.call(this,n)||this;return e.down=e.down.bind(e),e.up=e.up.bind(e),e.scroll=e.scroll.bind(e),e}return E(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("mousedown",this.down)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("mousedown",this.down)},n.prototype.down=function(t){var n;b(t)&&((null===(n=this.annotationCanvas.currentPage)||void 0===n?void 0:n.focusedObject)||(this.annotationCanvas.element.addEventListener("mousemove",this.scroll),this.annotationCanvas.element.addEventListener("mouseup",this.up)))},n.prototype.scroll=function(t){this.annotationCanvas.scrollX-=t.movementX/this.annotationCanvas.zoom,this.annotationCanvas.scrollY-=t.movementY/this.annotationCanvas.zoom,this.annotationCanvas.render()},n.prototype.up=function(){this.annotationCanvas.element.removeEventListener("mousemove",this.scroll),this.annotationCanvas.element.removeEventListener("mouseup",this.up),g.Z.instance.check(3)},n}(w);var S=e(2762),T=e.n(S),R=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const A=function(t){function n(n){var e=t.call(this,n)||this;return e.movement=e.movement.bind(e),e}return R(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("mousemove",this.movement)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("mousemove",this.movement)},n.prototype.movement=function(t){var n=this.annotationCanvas.currentPage;if(n){var e=t.pageX/this.annotationCanvas.zoom+this.annotationCanvas.scrollX,o=t.pageY/this.annotationCanvas.zoom+this.annotationCanvas.scrollY,i=function(t,n,e){var o=[];return t.eachObject((function(t){t.isPixelIn(n,e)&&o.push(t)})),T()(o,(function(t){return t.distanceToPixelEdge(n,e)}))}(n.collection,e,o);i!==n.focusedObject&&(n.focusedObject=i,this.annotationCanvas.render())}},n}(w);var I=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const z=function(t){function n(n){var e=t.call(this,n)||this;return e.canvasFocus=new A(n),e.down=e.down.bind(e),e}return I(n,t),n.prototype.on=function(){this.canvasFocus.on(),this.annotationCanvas.element.addEventListener("mousedown",this.down)},n.prototype.off=function(){this.canvasFocus.off(),this.annotationCanvas.element.removeEventListener("mousedown",this.down)},n.prototype.movement=function(t){this.canvasFocus.movement(t)},n.prototype.down=function(t){if(b(t)){var n=this.annotationCanvas.currentPage;n&&n.selectedObject!==n.focusedObject&&(n.selectedObject=n.focusedObject,this.annotationCanvas.render(),n.selectedObject?g.Z.instance.check(11):g.Z.instance.check(12))}},n}(w);var Z=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const X=function(t){function n(n){var e=t.call(this,n)||this;return e.labelSelect=a()(".relation-label-select").get(0),e.cursorCanvasSelection=new z(n),e.labelChange=e.labelChange.bind(e),e.down=e.down.bind(e),e.movement=e.movement.bind(e),_(j.a,e.labelSelect),e}return Z(n,t),n.prototype.on=function(){this.labelSelect.addEventListener("change",this.labelChange),this.labelChange(),this.annotationCanvas.element.addEventListener("mousemove",this.movement),this.annotationCanvas.element.addEventListener("mousedown",this.down),a()(".group-properties").show()},n.prototype.off=function(){this.labelSelect.removeEventListener("change",this.labelChange),this.annotationCanvas.element.removeEventListener("mousemove",this.movement),this.annotationCanvas.element.removeEventListener("mousedown",this.down),a()(".group-properties").hide()},n.prototype.labelChange=function(){this.annotationCanvas.render({relationClass:this.currentClass}),g.Z.instance.check(17)},n.prototype.down=function(t){if(b(t)){var n=this.annotationCanvas.currentPage;if(n){var e=n.selectedObject,o=n.focusedObject;if(e&&o&&e!==o){var i=j.a[parseInt(this.labelSelect.value,10)];n.collection.switchRelation(i,e,o),n.selectedObject=o,this.annotationCanvas.render(),n.collection.hasRelation(i,e,o)?g.Z.instance.check(18):g.Z.instance.check(19)}else this.cursorCanvasSelection.down(t)}}},n.prototype.movement=function(t){this.cursorCanvasSelection.movement(t)},Object.defineProperty(n.prototype,"currentClass",{get:function(){return j.a[parseInt(this.labelSelect.value,10)]},enumerable:!1,configurable:!0}),n}(w);var Y=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const M=function(t){function n(n){var e=t.call(this,n)||this;return e.movement=e.movement.bind(e),e}return Y(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("mousemove",this.movement)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("mousemove",this.movement)},n.prototype.movement=function(t){var n=t.pageX/this.annotationCanvas.zoom+this.annotationCanvas.scrollX,e=t.pageY/this.annotationCanvas.zoom+this.annotationCanvas.scrollY;this.annotationCanvas.render({pointerX:n,pointerY:e})},n}(w);var D=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const U=function(t){function n(n){var e=t.call(this,n)||this;return e.keyDown=e.keyDown.bind(e),e}return D(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("keydown",this.keyDown)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("keydown",this.keyDown)},n.prototype.keyDown=function(t){var n=this.annotationCanvas.currentPage;if(null==n?void 0:n.selectedObject){var e=!0;"Delete"===t.key?(n.removeAnnotation(n.selectedObject),g.Z.instance.check(15)):"ArrowLeft"===t.key?(n.selectedObject.x--,g.Z.instance.check(13)):"ArrowRight"===t.key?(n.selectedObject.x++,g.Z.instance.check(13)):"ArrowDown"===t.key?(n.selectedObject.y++,g.Z.instance.check(13)):"ArrowUp"===t.key?(n.selectedObject.y--,g.Z.instance.check(13)):"d"===t.key&&t.ctrlKey?(t.preventDefault(),n.selectedObject=n.collection.cloneAnnotation(n.selectedObject),g.Z.instance.check(14)):e=!1,e&&this.annotationCanvas.render()}},n}(w);var B=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const F=function(t){function n(n){var e=t.call(this,n)||this;return e.keyDown=e.keyDown.bind(e),e}return B(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("keydown",this.keyDown)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("keydown",this.keyDown)},n.prototype.keyDown=function(t){"d"!==t.key||t.ctrlKey?"a"===t.key&&(this.annotationCanvas.imageId--,g.Z.instance.check(5)):(this.annotationCanvas.imageId++,g.Z.instance.check(5))},n}(w);var K=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const W=function(t){function n(n){var e=t.call(this,n)||this;return e.nextPage=e.nextPage.bind(e),e.previousPage=e.previousPage.bind(e),e}return K(n,t),n.prototype.on=function(){a()(".next-page").on("click",this.nextPage),a()(".previous-page").on("click",this.previousPage)},n.prototype.off=function(){a()(".next-page").off("click",this.nextPage),a()(".previous-page").off("click",this.previousPage)},n.prototype.nextPage=function(){this.annotationCanvas.imageId++,g.Z.instance.check(5)},n.prototype.previousPage=function(){this.annotationCanvas.imageId--,g.Z.instance.check(5)},n}(w);var G=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const N=function(t){function n(n){var e=t.call(this,n)||this;return e.selectPage=e.selectPage.bind(e),e.reloadImageList=e.reloadImageList.bind(e),e.imageChanged=e.imageChanged.bind(e),e.reloadImageList(),e}return G(n,t),n.prototype.on=function(){this.annotationCanvas.on("images",this.reloadImageList),this.annotationCanvas.on("imagechange",this.imageChanged),this.addEventListenersToList()},n.prototype.off=function(){this.annotationCanvas.off("images",this.reloadImageList),this.annotationCanvas.off("imagechange",this.imageChanged),this.removeEventListenersFromList()},n.prototype.addEventListenersToList=function(){a()(".image-collection li").on("click",this.selectPage)},n.prototype.removeEventListenersFromList=function(){a()(".image-collection li").off("click",this.selectPage)},n.prototype.selectPage=function(t){var n=t.target.getAttribute("data-image-id");if(!n)throw new Error("data-image-id attribute is missing on selected element");var e=parseInt(n,10);this.annotationCanvas.imageId=e,g.Z.instance.check(6)},n.prototype.imageChanged=function(){var t;a()(".image-collection li").removeClass("selected");var n=a()('.image-collection li[data-image-id="'.concat(this.annotationCanvas.imageId,'"]'));n.addClass("selected"),null===(t=n.get(0))||void 0===t||t.scrollIntoView()},n.prototype.reloadImageList=function(){var t=a()(".image-collection");a()(".image-collection li").remove(),this.annotationCanvas.images.forEach((function(n,e){a()(document.createElement("li")).attr("data-image-id",e).text(n.title).appendTo(t)})),this.addEventListenersToList(),this.imageChanged()},n}(w);var V=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const H=function(t){function n(n){var e=t.call(this,n)||this;return e.button=new W(n),e.key=new F(n),e.list=new N(n),e}return V(n,t),n.prototype.on=function(){this.button.on(),this.key.on(),this.list.on()},n.prototype.off=function(){this.button.off(),this.key.off(),this.list.off()},n}(w);var q=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const J=function(t){function n(n){var e=t.call(this,n)||this;return e.wheel=e.wheel.bind(e),e}return q(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("wheel",this.wheel)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("wheel",this.wheel)},n.prototype.wheel=function(t){var n=.002*-t.deltaY;this.annotationCanvas.zoom+=n*this.annotationCanvas.zoom;var e=t.pageX*n/this.annotationCanvas.zoom,o=t.pageY*n/this.annotationCanvas.zoom;this.annotationCanvas.scrollX+=e,this.annotationCanvas.scrollY+=o,this.annotationCanvas.render(),g.Z.instance.check(4)},n}(w),Q=function(){function t(t){this.modulesByMode=new Map,this.annotationCanvas=t;var n=new L(t),e=new k(t),i=new z(t),a=new U(t),r=[n,i,a,new O(t)],s=[e,a],c=[n,new X(t),new M(t)];this.modulesByMode.set(o.CURSOR,r),this.modulesByMode.set(o.MARK,s),this.modulesByMode.set(o.GROUP,c),r.concat(s).concat(c).forEach((function(t){return t.off()})),this.mode=o.CURSOR,this.canvasMode||(this.canvasMode=o.CURSOR),this.fullTimeModules=[new J(t),new H(t)],this.fullTimeModules.forEach((function(t){return t.on()})),this.annotationCanvas.element.addEventListener("selectstart",(function(t){t.preventDefault()}))}return Object.defineProperty(t.prototype,"mode",{set:function(t){this.canvasMode!==t&&(a()(".tool-name").text("".concat(r.ZP.t("tools.mode.".concat(t)))),this.off(this.canvasMode),this.on(t),this.canvasMode=t,this.annotationCanvas.render({mode:t}))},enumerable:!1,configurable:!0}),t.prototype.turnOff=function(){this.off(this.canvasMode),this.fullTimeModules.forEach((function(t){return t.off()}))},t.prototype.on=function(t){var n;null===(n=this.modulesByMode.get(t))||void 0===n||n.forEach((function(t){return t.on()}))},t.prototype.off=function(t){var n;null===(n=this.modulesByMode.get(t))||void 0===n||n.forEach((function(t){return t.off()}))},t}(),$=function(){function t(t,n){t.on("click",this.download.bind(this)),this.dataCallback=n}return t.prototype.download=function(){var t=this.dataCallback(),n=new Blob([this.dataProcessor.processData(t)],{type:this.type}),e=document.createElement("a");e.setAttribute("download",this.dataProcessor.fileName(t)),e.setAttribute("target","blank"),e.setAttribute("href",URL.createObjectURL(n)),e.click()},t}();var tt=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),nt={processData:function(t){var n=[];t.eachObject((function(t){return n.push(t)}));var e=n.map((function(t){var n=t.klass,e=t.centerX,o=t.centerY,i=t.normalWidth,a=t.normalHeight;return[n.id,e.toPrecision(6),o.toPrecision(6),i.toPrecision(6),a.toPrecision(6)]})),o=[];return t.eachRelation((function(t){var e=t.klass,i=t.input,a=t.output;o.push([e.id,n.indexOf(i),n.indexOf(a)])})),e.push([]),e.concat(o).map((function(t){return t.join(" ")})).join("\n")},fileName:function(t){return t.imageTitle}};const et=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.type="text/plain",n.dataProcessor=nt,n}return tt(n,t),n}($),ot=function(t,n){a()(n).hide(),a()("".concat(n," .duplicate")).on("click",(function(){var n=t.currentPage;(null==n?void 0:n.selectedObject)&&(n.selectedObject=n.collection.cloneAnnotation(n.selectedObject),t.render(),g.Z.instance.check(14))})),a()("".concat(n," .remove")).on("click",(function(){var n=t.currentPage;(null==n?void 0:n.selectedObject)&&(n.removeAnnotation(n.selectedObject),t.render(),g.Z.instance.check(15))}))};var it=e(3311),at=e.n(it);const rt=function(){function t(t,n){var e=this;this.canvasControl=t,this.buttons=n,this.activate(this.buttons.first()),this.buttons.on("click",(function(t){e.activate(a()(t.target))}))}return Object.defineProperty(t.prototype,"mode",{set:function(t){var n=at()(this.buttons,(function(n){return n.classList.contains(t)}));n&&this.activate(a()(n))},enumerable:!1,configurable:!0}),t.prototype.activate=function(t){this.buttons.removeClass("tool-active"),t.addClass("tool-active");var n=at()(o,(function(n){return t.hasClass(n)}));n&&(this.canvasControl.mode=n,n===o.MARK?g.Z.instance.check(7):n===o.CURSOR?g.Z.instance.check(10):n===o.GROUP&&g.Z.instance.check(16))},t}();function st(t){t.images.length?a()(".editor").show():a()(".editor").hide()}const ct=function(){function t(t,n){var e=this;this.annotationCanvas=new y(n),t.on("pageReload",(function(){e.load()})),this.load(),window.addEventListener("beforeunload",(function(t){t.preventDefault(),t.returnValue=""}))}return Object.defineProperty(t.prototype,"images",{set:function(t){this.annotationCanvas.images=c()(t,"title"),st(this.annotationCanvas)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"annotations",{set:function(t){this.annotationCanvas.annotations=t},enumerable:!1,configurable:!0}),t.prototype.render=function(){this.annotationCanvas.render()},Object.defineProperty(t.prototype,"canvas",{get:function(){return this.annotationCanvas},enumerable:!1,configurable:!0}),t.prototype.load=function(){var t=this;st(this.annotationCanvas),this.canvasControl&&this.canvasControl.turnOff(),this.canvasControl=new Q(this.annotationCanvas);var n=new rt(this.canvasControl,a()(".tool-buttons > button"));new ot(this.annotationCanvas,".object-properties"),this.annotationCanvas.element.addEventListener("keydown",(function(t){"c"===t.key?n.mode=o.CURSOR:"w"===t.key?n.mode=o.MARK:"g"===t.key?n.mode=o.GROUP:"s"===t.key&&t.ctrlKey&&(a()(".download-annotations").trigger("click"),t.preventDefault())})),a()(".clear").on("click",(function(){confirm(r.ZP.t("clear_annotations_from_current_image_confirm"))&&(t.annotationCanvas.currentPage.clear(),t.annotationCanvas.render())})),new et(a()(".download-annotations"),(function(){var n=t.annotationCanvas.currentPage;return g.Z.instance.check(20),n.collection}))},t}()}}]);