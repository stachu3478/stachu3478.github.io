(self.webpackChunkomrat_client=self.webpackChunkomrat_client||[]).push([[189],{3980:(t,n,e)=>{var o=e(202);t.exports=(o.default||o).template({1:function(t,n,e,o,i){var r,a=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<owl:ObjectProperty rdf:about="#'+t.escapeExpression("function"==typeof(r=null!=(r=a(e,"title")||(null!=n?a(n,"title"):n))?r:t.hooks.helperMissing)?r.call(null!=n?n:t.nullContext||{},{name:"title",hash:{},data:i,loc:{start:{line:21,column:32},end:{line:21,column:43}}}):r)+'">\r\n  <rdfs:subPropertyOf rdf:resource="#has_relation"/>\r\n</owl:ObjectProperty>\r\n\r\n'},3:function(t,n,e,o,i){var r,a=null!=n?n:t.nullContext||{},s=t.hooks.helperMissing,c="function",l=t.escapeExpression,u=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<owl:Class rdf:about="#'+l(typeof(r=null!=(r=u(e,"title")||(null!=n?u(n,"title"):n))?r:s)===c?r.call(a,{name:"title",hash:{},data:i,loc:{start:{line:60,column:23},end:{line:60,column:34}}}):r)+'_cls">\r\n  <rdfs:subClassOf rdf:resource="#DataClass"/>\r\n  <rdfs:label rdf:datatype="http://www.w3.org/2001/XMLSchema#string">'+l(typeof(r=null!=(r=u(e,"title")||(null!=n?u(n,"title"):n))?r:s)===c?r.call(a,{name:"title",hash:{},data:i,loc:{start:{line:62,column:69},end:{line:62,column:80}}}):r)+"</rdfs:label>\r\n</owl:Class>\r\n\r\n<"+l(typeof(r=null!=(r=u(e,"title")||(null!=n?u(n,"title"):n))?r:s)===c?r.call(a,{name:"title",hash:{},data:i,loc:{start:{line:65,column:1},end:{line:65,column:12}}}):r)+'_cls rdf:about="#'+l(typeof(r=null!=(r=u(e,"title")||(null!=n?u(n,"title"):n))?r:s)===c?r.call(a,{name:"title",hash:{},data:i,loc:{start:{line:65,column:29},end:{line:65,column:40}}}):r)+'">\r\n  <rdf:type rdf:resource="http://www.w3.org/2002/07/owl#NamedIndividual"/>\r\n  <rdfs:label rdf:datatype="http://www.w3.org/2001/XMLSchema#string">'+l(typeof(r=null!=(r=u(e,"title")||(null!=n?u(n,"title"):n))?r:s)===c?r.call(a,{name:"title",hash:{},data:i,loc:{start:{line:67,column:69},end:{line:67,column:80}}}):r)+'</rdfs:label>\r\n  <has_idx rdf:datatype="http://www.w3.org/2001/XMLSchema#integer">'+l(typeof(r=null!=(r=u(e,"id")||(null!=n?u(n,"id"):n))?r:s)===c?r.call(a,{name:"id",hash:{},data:i,loc:{start:{line:68,column:67},end:{line:68,column:75}}}):r)+"</has_idx>\r\n</"+l(typeof(r=null!=(r=u(e,"title")||(null!=n?u(n,"title"):n))?r:s)===c?r.call(a,{name:"title",hash:{},data:i,loc:{start:{line:69,column:2},end:{line:69,column:13}}}):r)+"_cls>\r\n\r\n"},5:function(t,n,e,o,i){var r,a=t.lambda,s=t.escapeExpression,c=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<BB rdf:about="#'+s(a(null!=(r=null!=n?c(n,"annotation"):n)?c(r,"id"):r,n))+'">\r\n  <rdf:type rdf:resource="http://www.w3.org/2002/07/owl#NamedIndividual"/>\r\n  <has_cls rdf:resource="#'+s(a(null!=(r=null!=(r=null!=n?c(n,"annotation"):n)?c(r,"klass"):r)?c(r,"title"):r,n))+'"/>\r\n'+(null!=(r=c(e,"each").call(null!=n?n:t.nullContext||{},null!=n?c(n,"relations"):n,{name:"each",hash:{},fn:t.program(6,i,0),inverse:t.noop,data:i,loc:{start:{line:76,column:2},end:{line:78,column:12}}}))?r:"")+'  <has_idx rdf:datatype="http://www.w3.org/2001/XMLSchema#integer">'+s(a(null!=(r=null!=n?c(n,"annotation"):n)?c(r,"id"):r,n))+'</has_idx>\r\n  <has_x rdf:datatype="http://www.w3.org/2001/XMLSchema#decimal">'+s(a(null!=(r=null!=n?c(n,"annotation"):n)?c(r,"normalX"):r,n))+'</has_x>\r\n  <has_y rdf:datatype="http://www.w3.org/2001/XMLSchema#decimal">'+s(a(null!=(r=null!=n?c(n,"annotation"):n)?c(r,"normalY"):r,n))+'</has_y>\r\n  <has_w rdf:datatype="http://www.w3.org/2001/XMLSchema#decimal">'+s(a(null!=(r=null!=n?c(n,"annotation"):n)?c(r,"normalWidth"):r,n))+'</has_w>\r\n  <has_h rdf:datatype="http://www.w3.org/2001/XMLSchema#decimal">'+s(a(null!=(r=null!=n?c(n,"annotation"):n)?c(r,"normalHeight"):r,n))+"</has_h>\r\n</BB>\r\n\r\n"},6:function(t,n,e,o,i){var r,a=t.lambda,s=t.escapeExpression,c=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return"  <"+s(a(null!=(r=null!=n?c(n,"klass"):n)?c(r,"title"):r,n))+' rdf:resource="#'+s(a(null!=(r=null!=n?c(n,"output"):n)?c(r,"id"):r,n))+'"/>\r\n'},compiler:[8,">= 4.3.0"],main:function(t,n,e,o,i){var r,a=null!=n?n:t.nullContext||{},s=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<?xml version="1.0"?>\r\n<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\r\n         xmlns:xsd="http://www.w3.org/2001/XMLSchema#"\r\n         xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"\r\n         xmlns:owl="http://www.w3.org/2002/07/owl#"\r\n         xml:base="http://fbctene.pl/sg"\r\n         xmlns="http://fbctene.pl/sg#">\r\n\r\n<owl:Ontology rdf:about="http://fbctene.pl/sg"/>\r\n\r\n<owl:ObjectProperty rdf:about="#has_cls">\r\n  <rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>\r\n  <rdfs:range rdf:resource="#DataClass"/>\r\n</owl:ObjectProperty>\r\n\r\n<owl:ObjectProperty rdf:about="#has_relation">\r\n  <rdfs:range rdf:resource="#DataClass"/>\r\n</owl:ObjectProperty>\r\n\r\n'+(null!=(r=s(e,"each").call(a,null!=n?s(n,"relations"):n,{name:"each",hash:{},fn:t.program(1,i,0),inverse:t.noop,data:i,loc:{start:{line:20,column:0},end:{line:25,column:10}}}))?r:"")+'<owl:DatatypeProperty rdf:about="#has_idx">\r\n  <rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>\r\n  <rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#integer"/>\r\n</owl:DatatypeProperty>\r\n\r\n<owl:DatatypeProperty rdf:about="#has_x">\r\n  <rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>\r\n  <rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#decimal"/>\r\n</owl:DatatypeProperty>\r\n\r\n<owl:DatatypeProperty rdf:about="#has_y">\r\n  <rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>\r\n  <rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#decimal"/>\r\n</owl:DatatypeProperty>\r\n\r\n<owl:DatatypeProperty rdf:about="#has_w">\r\n  <rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>\r\n  <rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#decimal"/>\r\n</owl:DatatypeProperty>\r\n\r\n<owl:DatatypeProperty rdf:about="#has_h">\r\n  <rdf:type rdf:resource="http://www.w3.org/2002/07/owl#FunctionalProperty"/>\r\n  <rdfs:range rdf:resource="http://www.w3.org/2001/XMLSchema#decimal"/>\r\n</owl:DatatypeProperty>\r\n\r\n<owl:Class rdf:about="#BB">\r\n  <rdfs:subClassOf rdf:resource="http://www.w3.org/2002/07/owl#Thing"/>\r\n</owl:Class>\r\n\r\n<owl:Class rdf:about="#DataClass">\r\n  <rdfs:subClassOf rdf:resource="http://www.w3.org/2002/07/owl#Thing"/>\r\n</owl:Class>\r\n\r\n'+(null!=(r=s(e,"each").call(a,null!=n?s(n,"classes"):n,{name:"each",hash:{},fn:t.program(3,i,0),inverse:t.noop,data:i,loc:{start:{line:59,column:0},end:{line:71,column:10}}}))?r:"")+(null!=(r=s(e,"each").call(a,null!=n?s(n,"annotations"):n,{name:"each",hash:{},fn:t.program(5,i,0),inverse:t.noop,data:i,loc:{start:{line:72,column:0},end:{line:86,column:9}}}))?r:"")+"\r\n</rdf:RDF>\r\n"},useData:!0})},6400:(t,n,e)=>{"use strict";e.r(n),e.d(n,{default:()=>St});var o,i=e(9755),r=e.n(i),a=e(7268),s=e(9734),c=e.n(s);function l(t,n){var e=9/n,o=Math.min(t.x,t.x+t.width),i=Math.max(t.x,t.x+t.width),r=Math.min(t.y,t.y+t.height),a=Math.max(t.y,t.y+t.height);return[{x:o-e,y:r-e,lockX:!1,lockY:!1,resizeCenterX:i,resizeCenterY:a,edgeX:o,edgeY:r,direction:"topLeft"},{x:i+e,y:r-e,lockX:!1,lockY:!1,resizeCenterX:o,resizeCenterY:a,edgeX:i,edgeY:r,direction:"topRight"},{x:o-e,y:a+e,lockX:!1,lockY:!1,resizeCenterX:i,resizeCenterY:r,edgeX:o,edgeY:a,direction:"bottomLeft"},{x:i+e,y:a+e,lockX:!1,lockY:!1,resizeCenterX:o,resizeCenterY:r,edgeX:i,edgeY:a,direction:"bottomRight"},{x:o+Math.abs(t.width)/2,y:r-e,lockX:!0,lockY:!1,resizeCenterX:i,resizeCenterY:a,edgeX:o+Math.abs(t.width)/2,edgeY:r,direction:"top"},{x:o-e,y:r+Math.abs(t.height)/2,lockX:!1,lockY:!0,resizeCenterX:i,resizeCenterY:a,edgeX:o,edgeY:r+Math.abs(t.height)/2,direction:"left"},{x:i+e,y:r+Math.abs(t.height)/2,lockX:!1,lockY:!0,resizeCenterX:o,resizeCenterY:r,edgeX:i,edgeY:r+Math.abs(t.height)/2,direction:"right"},{x:o+Math.abs(t.width)/2,y:a+e,lockX:!0,lockY:!1,resizeCenterX:o,resizeCenterY:r,edgeX:o+Math.abs(t.width)/2,edgeY:a,direction:"bottom"}]}function u(t,n){return t.pageX/n.zoom+n.scrollX}function h(t,n){return t.pageY/n.zoom+n.scrollY}function p(t,n,e){var o=u(n,e),i=h(n,e);return l(t,e.zoom).find((function(t){return Math.hypot(t.x-o,t.y-i)<=7/e.zoom}))}!function(t){t.CURSOR="cursor",t.MARK="mark",t.GROUP="group"}(o||(o={}));var f=2*Math.PI;const d=function(){function t(t){this.arrowDashSize=0,this.defaultLineWidth=0,this.ctx=t,this.params={width:0,height:0,zoom:1,scrollX:0,scrollY:0,mode:o.CURSOR,pointerX:0,pointerY:0}}return t.prototype.start=function(){var t=this.params,n=t.width,e=t.height,o=t.zoom,i=t.scrollX,r=t.scrollY;this.ctx.imageSmoothingEnabled=!1,this.ctx.clearRect(0,0,n,e),this.ctx.scale(o,o),this.ctx.translate(-i,-r),this.ctx.font="".concat(12/this.params.zoom,"px ").concat("Verdana, sans-serif"),this.arrowDashSize=10/this.params.zoom,this.defaultLineWidth=2/this.params.zoom},t.prototype.drawImage=function(t){this.ctx.drawImage(t,0,0),document.body.classList.contains("dark")&&(this.ctx.globalCompositeOperation="difference",this.ctx.fillStyle="#eee",this.ctx.fillRect(0,0,t.width,t.height),this.ctx.globalCompositeOperation="source-over")},t.prototype.drawObjects=function(t,n){var e=this;this.ctx.lineWidth=this.defaultLineWidth,t.eachObject((function(t){n.has(t.klass)&&(e.ctx.strokeStyle=t.klass.color,e.ctx.strokeRect(t.x,t.y,t.width,t.height))}))},t.prototype.drawRelations=function(t,n){var e=this;this.ctx.lineWidth=this.defaultLineWidth,t.eachRelation((function(t){n.has(t.input.klass)&&n.has(t.output.klass)&&e.drawRelation(t,!0)}))},t.prototype.drawFocusedObject=function(t){var n=this.params.zoom;this.ctx.fillStyle="".concat(t.klass.color,"40"),this.ctx.fillRect(t.x,t.y,t.width,t.height);var e=this.ctx.measureText(t.klass.title).width;this.ctx.fillStyle="black",this.ctx.fillRect(t.x,t.y,e+6/n,18/n),this.ctx.fillStyle="white",this.ctx.strokeStyle="white",this.ctx.textBaseline="hanging",this.ctx.fillText(t.klass.title,t.x+3/n,t.y+3/n)},t.prototype.drawSelectedObject=function(t){var n=this,e=this.params.zoom;this.ctx.strokeStyle=t.klass.color,this.ctx.lineWidth=5/e,this.ctx.strokeRect(t.x,t.y,t.width,t.height),this.ctx.fillStyle="".concat(t.klass.color,"40"),this.ctx.fillRect(t.x,t.y,t.width,t.height),l(t,e).forEach((function(o){n.ctx.strokeStyle="".concat(t.klass.color,"40"),n.ctx.fillStyle=t.klass.color,n.ctx.beginPath(),n.ctx.arc(o.x,o.y,7/e,0,f),n.ctx.fill(),n.ctx.stroke()}))},t.prototype.end=function(){this.ctx.resetTransform()},t.prototype.drawRelation=function(t,n){void 0===n&&(n=!0);var e=t.input.centerPixelX,o=t.input.centerPixelY;this.drawArrow(e,o,t.output.centerPixelX,t.output.centerPixelY,t.klass.color,!n)},t.prototype.drawArrow=function(t,n,e,o,i,r){this.ctx.strokeStyle=i;var a=this.ctx.getTransform(),s=Math.atan2(o-n,e-t),c=Math.hypot(o-n,e-t);r?this.ctx.setLineDash([this.arrowDashSize]):this.ctx.setLineDash([]),this.ctx.translate(e,o),this.ctx.rotate(s-Math.PI/2),this.ctx.beginPath(),this.ctx.moveTo(0,-c),this.ctx.lineTo(0,0),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.setTransform(a)},t.prototype.drawRelationAbsence=function(t,n){var e=this.ctx.measureText("X").width,o=this.ctx.getTransform();this.ctx.translate(t-5*e/2,n),this.ctx.scale(5,5),this.ctx.textBaseline="middle",this.ctx.fillStyle="red",this.ctx.fillText("X",0,0),this.ctx.setTransform(o)},t.prototype.drawCrosshair=function(){this.ctx.strokeStyle="gray",this.ctx.beginPath(),this.ctx.moveTo(Math.round(this.params.pointerX),this.params.scrollY),this.ctx.lineTo(Math.round(this.params.pointerX),this.params.scrollY+this.params.height/this.params.zoom),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.params.scrollX,Math.round(this.params.pointerY)),this.ctx.lineTo(this.params.scrollX+this.params.width/this.params.zoom,Math.round(this.params.pointerY)),this.ctx.stroke()},t}();var v,y=e(9564),m=e(9537),w=e(6480),g=e(6632),b=(v=function(t,n){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},v(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}v(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)});const C=function(t){function n(n,e){var o=t.call(this)||this;return o.visibleClasses=new Set,o.image=e,o.renderer=new d(n),o.annotationCollection=new m.Z(e.title),o.annotationCollection.dimensions={width:o.image.width,height:o.image.height},g.Z.get().forEach((function(t){return o.visibleClasses.add(t)})),o}return b(n,t),n.prototype.clear=function(){this.collection.clear(),delete this.selected,delete this.focusedObject},n.prototype.render=function(t){if(this.renderer.params=t,this.renderer.start(),this.renderer.drawImage(this.image),this.renderer.drawObjects(this.collection,this.visibleClasses),this.renderer.drawRelations(this.collection,this.visibleClasses),this.focusedObject&&this.renderer.drawFocusedObject(this.focusedObject),this.selectedObject&&this.renderer.drawSelectedObject(this.selectedObject),t.mode===o.GROUP&&this.selectedObject){var n=t.relationClass;if(!n)return;if(this.focusedObject)this.collection.hasRelation(n,this.selectedObject,this.focusedObject)?this.renderer.drawRelationAbsence(this.focusedObject.centerPixelX,this.focusedObject.centerPixelY):this.renderer.drawRelation(new y.Z(n,this.selectedObject,this.focusedObject),!1);else{var e=this.selectedObject.centerPixelX,i=this.selectedObject.centerPixelY;this.renderer.drawArrow(e,i,t.pointerX,t.pointerY,n.color,!0)}}t.mode===o.MARK&&this.renderer.drawCrosshair(),this.renderer.end()},n.prototype.removeAnnotation=function(t){this.collection.removeAnnotation(t),this.selected===t&&(this.selectedObject=void 0)},n.prototype.setClassVisibility=function(t,n){n?this.visibleClasses.add(t):this.visibleClasses.delete(t)},n.prototype.toggleAnnotationsVisibility=function(t){var n=this;void 0===t&&(t=g.Z.get().some((function(t){return!n.visibleClasses.has(t)})));var e=g.Z.get();return t?e.forEach((function(t){return n.visibleClasses.add(t)})):e.forEach((function(t){return n.visibleClasses.delete(t)})),t},n.prototype.getClassVisibility=function(t){return this.visibleClasses.has(t)},Object.defineProperty(n.prototype,"collection",{get:function(){return this.annotationCollection},set:function(t){this.annotationCollection=t,this.annotationCollection.dimensions={width:this.image.width,height:this.image.height},this.annotationCollection.imageTitle=this.annotatedImage.title},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"annotatedImage",{get:function(){return this.image},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"selectedObject",{get:function(){return this.selected},set:function(t){this.selected=t,this.emit("selectedObject")},enumerable:!1,configurable:!0}),n}(w.Z);var O=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),j=function(){return j=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},j.apply(this,arguments)};const _=function(t){function n(n){var e=t.call(this)||this;e.scrollX=0,e.scrollY=0,e.zoom=1,e.pageImages=[],e.currentPageId=0,e.pagesCollection=[],e.navigationParams={mode:o.CURSOR,pointerX:0,pointerY:0};var i=n.get(0);if(!i)throw new Error("HTMLCanvasElement is missing");e.canvas=i;var r=i.getContext("2d");if(!r)throw new Error("HTMLCanvasElement context is missing");return e.ctx=r,e.images=[],e.selectedObject=e.selectedObject.bind(e),e}return O(n,t),n.prototype.render=function(t){void 0===t&&(t={});var n=this.currentPage;this.navigationParams=Object.assign(this.navigationParams,t),n&&n.render(j({width:this.canvas.width,height:this.canvas.height,zoom:this.zoom,scrollX:this.scrollX,scrollY:this.scrollY},this.navigationParams))},n.prototype.selectedObject=function(){this.emit("selectedObject")},Object.defineProperty(n.prototype,"images",{get:function(){return this.pageImages},set:function(t){var n=this;this.pageImages.length&&!window.confirm(a.ZP.t("load_new_images_confirm"))||(this.pageImages=t,this.pagesCollection=t.map((function(t){return new C(n.ctx,t)})),t.length?(this.imageId=this.currentPageId,r()(".total-images-count").text(t.length.toString()),r()(".pagination").show()):r()(".pagination").hide(),this.scrollX=0,this.scrollY=0,this.emit("images"))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"annotations",{set:function(t){var n=this;t.forEach((function(e){var o=n.pagesCollection.find((function(t){return t.annotatedImage.title===e.imageTitle}));o?o.collection=e:1===t.length&&(n.currentPage.collection=e)})),this.render()},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"imageId",{get:function(){return this.currentPageId},set:function(t){var n;this.pagesCollection.length&&(null===(n=this.currentPage)||void 0===n||n.off("selectedObject",this.selectedObject),this.currentPageId=t%this.pagesCollection.length,this.currentPageId<0&&(this.currentPageId+=this.pagesCollection.length),this.currentPage.on("selectedObject",this.selectedObject),this.emit("selectedObject"),r()(".current-image-id").text((this.currentPageId+1).toString()),r()(".image-title").text(this.currentPage.annotatedImage.title),this.emit("imagechange"),this.render())},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"element",{get:function(){return this.canvas.parentElement},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"plane",{get:function(){return this.canvas},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentPage",{get:function(){return this.pagesCollection[this.currentPageId]},enumerable:!1,configurable:!0}),n}(w.Z),x=function(t){this.annotationCanvas=t};var P=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const k=function(t){function n(n){var e=t.call(this,n)||this;return e.objectsCollectionRoot=r()(".annotation-label-visibility-list").get(0),e.change=e.change.bind(e),e.imageChanged=e.imageChanged.bind(e),g.Z.get().forEach((function(t){return e.appendClass(t)})),e}return P(n,t),n.prototype.on=function(){var t,n=this;null===(t=this.annotationCanvas.currentPage)||void 0===t||t.toggleAnnotationsVisibility(!0),r()("ul.annotation-label-visibility-list > li").each((function(t,e){e.addEventListener("change",n.change);var o=e.querySelector("input");o&&(o.checked=!0)})),this.annotationCanvas.on("imagechange",this.imageChanged)},n.prototype.off=function(){var t=this;r()("ul.annotation-label-visibility-list > li").each((function(n,e){e.removeEventListener("change",t.change)})),this.annotationCanvas.off("imagechange",this.imageChanged)},n.prototype.change=function(t){var n=t.target,e=n.checked,o=this.annotationCanvas.currentPage;if("all"===n.value){var i=o.toggleAnnotationsVisibility();r()("ul.annotation-label-visibility-list > li input").each((function(t,n){n.checked=i}))}else{var a=g.Z.get()[parseInt(n.value,10)];o.setClassVisibility(a,e)}this.annotationCanvas.render()},n.prototype.appendClass=function(t){var n=document.querySelector("ul.annotation-label-visibility-list > template").content.querySelector("li"),e=document.importNode(n,!0);this.objectsCollectionRoot.appendChild(e);var o=e.querySelector("input"),i="class-visibility-".concat(t.id);o.setAttribute("value","".concat(t.id)),o.setAttribute("id",i);var r=e.querySelector("label");r.setAttribute("for",i),r.innerText=t.title},n.prototype.imageChanged=function(){var t=this.annotationCanvas.currentPage;t&&r()("ul.annotation-label-visibility-list > li input").each((function(n,e){var o=e;"all"!==o.value&&(o.checked=t.getClassVisibility(g.Z.get()[parseInt(o.value,10)]))}))},n}(x);var E=e(7012);function L(t){return t.composedPath().every((function(t){var n=t;return"ASIDE"!==n.tagName&&"NAV"!==n.tagName}))}var S=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const X=function(t){function n(n){var e=t.call(this,n)||this;return e.startX=0,e.startY=0,e.objectStartX=0,e.objectStartY=0,e.down=e.down.bind(e),e.up=e.up.bind(e),e.scroll=e.scroll.bind(e),e}return S(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("mousedown",this.down)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("mousedown",this.down)},n.prototype.down=function(t){var n;L(t)&&(this.clickedObject=null===(n=this.annotationCanvas.currentPage)||void 0===n?void 0:n.focusedObject,this.clickedObject&&(this.startX=-t.pageX/this.annotationCanvas.zoom+this.clickedObject.x,this.startY=-t.pageY/this.annotationCanvas.zoom+this.clickedObject.y,this.annotationCanvas.element.addEventListener("mousemove",this.scroll),this.annotationCanvas.element.addEventListener("mouseup",this.up)))},n.prototype.scroll=function(t){this.clickedObject&&(this.clickedObject.x=this.startX+t.pageX/this.annotationCanvas.zoom,this.clickedObject.y=this.startY+t.pageY/this.annotationCanvas.zoom,this.annotationCanvas.render())},n.prototype.up=function(){this.annotationCanvas.element.removeEventListener("mousemove",this.scroll),this.annotationCanvas.element.removeEventListener("mouseup",this.up),this.clickedObject&&E.Z.instance.check(13)},n}(x);var Y=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const z=function(t){function n(n){var e=t.call(this,n)||this;return e.cornerOffsetX=0,e.cornerOffsetY=0,e.down=e.down.bind(e),e.up=e.up.bind(e),e.scroll=e.scroll.bind(e),e}return Y(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("mousedown",this.down)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("mousedown",this.down)},n.prototype.down=function(t){var n,e;L(t)&&(null===(n=this.annotation)||void 0===n||n.absolutizeDimensions(),this.annotation=null===(e=this.annotationCanvas.currentPage)||void 0===e?void 0:e.selectedObject,this.annotation&&(this.pulley=p(this.annotation,t,this.annotationCanvas),this.pulley&&(this.cornerOffsetX=this.pulley.edgeX-u(t,this.annotationCanvas),this.cornerOffsetY=this.pulley.edgeY-h(t,this.annotationCanvas),(this.pulley.resizeCenterX<this.annotation.x||"top"===this.pulley.direction)&&(this.annotation.width=-this.annotation.width),(this.pulley.resizeCenterY<this.annotation.y||"left"===this.pulley.direction)&&(this.annotation.height=-this.annotation.height),this.annotation.x=this.pulley.resizeCenterX,this.annotation.y=this.pulley.resizeCenterY,this.annotationCanvas.element.addEventListener("mousemove",this.scroll),this.annotationCanvas.element.addEventListener("mouseup",this.up))))},n.prototype.scroll=function(t){if(this.annotation&&this.pulley){var n=u(t,this.annotationCanvas)-this.annotation.x+this.cornerOffsetX||1,e=h(t,this.annotationCanvas)-this.annotation.y+this.cornerOffsetY||1;if(!t.ctrlKey||this.pulley.lockX||this.pulley.lockY)this.pulley.lockX||(this.annotation.width=n),this.pulley.lockY||(this.annotation.height=e);else{var o=Math.max(Math.abs(n),Math.abs(e));this.annotation.width=(n>0?1:-1)*o,this.annotation.height=(e>0?1:-1)*o}this.annotationCanvas.render()}},n.prototype.up=function(){this.annotationCanvas.element.removeEventListener("mousemove",this.scroll),this.annotationCanvas.element.removeEventListener("mouseup",this.up),this.annotation&&this.annotation.absolutizeDimensions()},n}(x);var M=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const T=function(t){function n(n){var e=t.call(this,n)||this;return e.position=new X(n),e.size=new z(n),e}return M(n,t),n.prototype.on=function(){this.position.on(),this.size.on(),r()(".cursor-properties").show()},n.prototype.off=function(){this.position.off(),this.size.off(),r()(".cursor-properties").hide()},n}(x);function R(t,n){t.forEach((function(t){var e=document.createElement("option");e.innerText=t.title,e.value=t.id.toString(),n.append(e)}))}var A=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),D=function(){return E.Z.instance.check(8)};const I=function(t){function n(n){var e=t.call(this,n)||this;return e.labelSelect=r()(".mark-properties .annotation-label-select").get(0),e.down=e.down.bind(e),e.up=e.up.bind(e),e.draw=e.draw.bind(e),R(g.Z.get(),e.labelSelect),e}return A(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("mousedown",this.down),r()(".mark-properties").show(),r()(document.body).addClass("aiming"),this.labelSelect.addEventListener("change",D)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("mousedown",this.down),r()(".mark-properties").hide(),r()(document.body).removeClass("aiming"),this.labelSelect.removeEventListener("change",D)},n.prototype.down=function(t){var n;if(L(t)){var e=this.annotationCanvas.currentPage;e&&(null===(n=this.annotation)||void 0===n||n.absolutizeDimensions(),this.annotation=e.collection.createAnnotationObject(this.currentClass),this.annotation.x=this.cursorToCanvasX(t),this.annotation.y=this.cursorToCanvasY(t),this.annotationCanvas.element.addEventListener("mousemove",this.draw),this.annotationCanvas.element.addEventListener("mouseup",this.up))}},n.prototype.draw=function(t){if(this.annotation){var n=this.cursorToCanvasX(t)-this.annotation.x||1,e=this.cursorToCanvasY(t)-this.annotation.y||1;if(t.ctrlKey){var o=Math.max(Math.abs(n),Math.abs(e));this.annotation.width=(n>0?1:-1)*o,this.annotation.height=(e>0?1:-1)*o}else this.annotation.width=n,this.annotation.height=e;this.annotationCanvas.render()}},n.prototype.up=function(){this.annotationCanvas.element.removeEventListener("mousemove",this.draw),this.annotationCanvas.element.removeEventListener("mouseup",this.up);var t=this.annotationCanvas.currentPage;this.annotation&&(this.annotation.absolutizeDimensions(),E.Z.instance.check(9)),t&&(t.selectedObject=this.annotation,this.annotationCanvas.render())},Object.defineProperty(n.prototype,"currentClass",{get:function(){return g.Z.get()[parseInt(this.labelSelect.value,10)]},enumerable:!1,configurable:!0}),n.prototype.cursorToCanvasX=function(t){return t.pageX/this.annotationCanvas.zoom+this.annotationCanvas.scrollX},n.prototype.cursorToCanvasY=function(t){return t.pageY/this.annotationCanvas.zoom+this.annotationCanvas.scrollY},n}(x);var Z=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const F=function(t){function n(n){var e=t.call(this,n)||this;return e.down=e.down.bind(e),e.up=e.up.bind(e),e.scroll=e.scroll.bind(e),e}return Z(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("mousedown",this.down)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("mousedown",this.down)},n.prototype.down=function(t){if(L(t)){var n=this.annotationCanvas.currentPage;if(!(null==n?void 0:n.focusedObject)){if((null==n?void 0:n.selectedObject)&&p(n.selectedObject,t,this.annotationCanvas))return;this.annotationCanvas.element.addEventListener("mousemove",this.scroll),this.annotationCanvas.element.addEventListener("mouseup",this.up)}}},n.prototype.scroll=function(t){this.annotationCanvas.scrollX-=t.movementX/this.annotationCanvas.zoom,this.annotationCanvas.scrollY-=t.movementY/this.annotationCanvas.zoom,this.annotationCanvas.render()},n.prototype.up=function(){this.annotationCanvas.element.removeEventListener("mousemove",this.scroll),this.annotationCanvas.element.removeEventListener("mouseup",this.up),E.Z.instance.check(3)},n}(x);var U=e(2762),B=e.n(U),V=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const W=function(t){function n(n){var e=t.call(this,n)||this;return e.movement=e.movement.bind(e),e}return V(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("mousemove",this.movement)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("mousemove",this.movement)},n.prototype.movement=function(t){var n=this.annotationCanvas.currentPage;if(n){var e=t.pageX/this.annotationCanvas.zoom+this.annotationCanvas.scrollX,o=t.pageY/this.annotationCanvas.zoom+this.annotationCanvas.scrollY,i=[],r=n.selectedObject,a=n.focusedObject;if(r&&p(r,t,this.annotationCanvas))return void(a&&(n.focusedObject=void 0,this.annotationCanvas.render()));n.collection.eachObject((function(t){n.getClassVisibility(t.klass)&&i.push(t)}));var s=function(t,n,e){var o=t.filter((function(t){return t.isPixelIn(n,e)}));return B()(o,(function(t){return t.distanceToPixelEdge(n,e)}))}(i,e,o);s!==a&&(n.focusedObject=s,this.annotationCanvas.render())}},n}(x);var K=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const N=function(t){function n(n){var e=t.call(this,n)||this;return e.canvasFocus=new W(n),e.down=e.down.bind(e),e}return K(n,t),n.prototype.on=function(){this.canvasFocus.on(),this.annotationCanvas.element.addEventListener("mousedown",this.down)},n.prototype.off=function(){this.canvasFocus.off(),this.annotationCanvas.element.removeEventListener("mousedown",this.down)},n.prototype.movement=function(t){this.canvasFocus.movement(t)},n.prototype.down=function(t){if(L(t)){var n=this.annotationCanvas.currentPage;if(n){if(n.selectedObject&&p(n.selectedObject,t,this.annotationCanvas))return;n.selectedObject!==n.focusedObject&&(n.selectedObject=n.focusedObject,this.annotationCanvas.render(),n.selectedObject?E.Z.instance.check(11):E.Z.instance.check(12))}}},n}(x);var H=e(19),q=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const G=function(t){function n(n){var e=t.call(this,n)||this;return e.labelSelect=r()(".relation-label-select").get(0),e.cursorCanvasSelection=new N(n),e.labelChange=e.labelChange.bind(e),e.down=e.down.bind(e),e.movement=e.movement.bind(e),R(H.ac,e.labelSelect),e}return q(n,t),n.prototype.on=function(){this.labelSelect.addEventListener("change",this.labelChange),this.labelChange(),this.annotationCanvas.element.addEventListener("mousemove",this.movement),this.annotationCanvas.element.addEventListener("mousedown",this.down),r()(".group-properties").show()},n.prototype.off=function(){this.labelSelect.removeEventListener("change",this.labelChange),this.annotationCanvas.element.removeEventListener("mousemove",this.movement),this.annotationCanvas.element.removeEventListener("mousedown",this.down),r()(".group-properties").hide()},n.prototype.labelChange=function(){this.annotationCanvas.render({relationClass:this.currentClass}),E.Z.instance.check(17)},n.prototype.down=function(t){if(L(t)){var n=this.annotationCanvas.currentPage;if(n){var e=n.selectedObject,o=n.focusedObject;if(e&&o&&e!==o){var i=H.ac[parseInt(this.labelSelect.value,10)];n.collection.switchRelation(i,e,o),n.selectedObject=o,this.annotationCanvas.render(),n.collection.hasRelation(i,e,o)?E.Z.instance.check(18):E.Z.instance.check(19)}else this.cursorCanvasSelection.down(t)}}},n.prototype.movement=function(t){this.cursorCanvasSelection.movement(t)},Object.defineProperty(n.prototype,"currentClass",{get:function(){return H.ac[parseInt(this.labelSelect.value,10)]},enumerable:!1,configurable:!0}),n}(x);var J=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const Q=function(t){function n(n){var e=t.call(this,n)||this;return e.movement=e.movement.bind(e),e}return J(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("mousemove",this.movement)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("mousemove",this.movement)},n.prototype.movement=function(t){var n=t.pageX/this.annotationCanvas.zoom+this.annotationCanvas.scrollX,e=t.pageY/this.annotationCanvas.zoom+this.annotationCanvas.scrollY;this.annotationCanvas.render({pointerX:n,pointerY:e})},n}(x);var $=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const tt=function(t){function n(n){var e=t.call(this,n)||this;return e.keyDown=e.keyDown.bind(e),e}return $(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("keydown",this.keyDown)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("keydown",this.keyDown)},n.prototype.keyDown=function(t){var n=this.annotationCanvas.currentPage;if(null==n?void 0:n.selectedObject){var e=!0;"Delete"===t.key?(n.removeAnnotation(n.selectedObject),E.Z.instance.check(15)):"ArrowLeft"===t.key?(n.selectedObject.x--,E.Z.instance.check(13)):"ArrowRight"===t.key?(n.selectedObject.x++,E.Z.instance.check(13)):"ArrowDown"===t.key?(n.selectedObject.y++,E.Z.instance.check(13)):"ArrowUp"===t.key?(n.selectedObject.y--,E.Z.instance.check(13)):"d"===t.key&&t.ctrlKey?(t.preventDefault(),n.selectedObject=n.collection.cloneAnnotation(n.selectedObject),E.Z.instance.check(14)):e=!1,e&&this.annotationCanvas.render()}},n}(x);var nt=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const et=function(t){function n(n){var e=t.call(this,n)||this;return e.keyDown=e.keyDown.bind(e),e}return nt(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("keydown",this.keyDown)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("keydown",this.keyDown)},n.prototype.keyDown=function(t){"d"!==t.key||t.ctrlKey?"a"===t.key&&(this.annotationCanvas.imageId--,E.Z.instance.check(5)):(this.annotationCanvas.imageId++,E.Z.instance.check(5))},n}(x);var ot=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const it=function(t){function n(n){var e=t.call(this,n)||this;return e.nextPage=e.nextPage.bind(e),e.previousPage=e.previousPage.bind(e),e}return ot(n,t),n.prototype.on=function(){r()(".next-page").on("click",this.nextPage),r()(".previous-page").on("click",this.previousPage)},n.prototype.off=function(){r()(".next-page").off("click",this.nextPage),r()(".previous-page").off("click",this.previousPage)},n.prototype.nextPage=function(){this.annotationCanvas.imageId++,E.Z.instance.check(5)},n.prototype.previousPage=function(){this.annotationCanvas.imageId--,E.Z.instance.check(5)},n}(x);var rt=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const at=function(t){function n(n){var e=t.call(this,n)||this;return e.selectPage=e.selectPage.bind(e),e.reloadImageList=e.reloadImageList.bind(e),e.imageChanged=e.imageChanged.bind(e),e.reloadImageList(),e}return rt(n,t),n.prototype.on=function(){this.annotationCanvas.on("images",this.reloadImageList),this.annotationCanvas.on("imagechange",this.imageChanged),this.addEventListenersToList()},n.prototype.off=function(){this.annotationCanvas.off("images",this.reloadImageList),this.annotationCanvas.off("imagechange",this.imageChanged),this.removeEventListenersFromList()},n.prototype.addEventListenersToList=function(){r()(".image-collection li").on("click",this.selectPage)},n.prototype.removeEventListenersFromList=function(){r()(".image-collection li").off("click",this.selectPage)},n.prototype.selectPage=function(t){var n=t.target.getAttribute("data-image-id");if(!n)throw new Error("data-image-id attribute is missing on selected element");var e=parseInt(n,10);this.annotationCanvas.imageId=e,E.Z.instance.check(6)},n.prototype.imageChanged=function(){var t;r()(".image-collection li").removeClass("selected");var n=r()('.image-collection li[data-image-id="'.concat(this.annotationCanvas.imageId,'"]'));n.addClass("selected"),null===(t=n.get(0))||void 0===t||t.scrollIntoView()},n.prototype.reloadImageList=function(){var t=r()(".image-collection");r()(".image-collection li").remove(),this.annotationCanvas.images.forEach((function(n,e){r()(document.createElement("li")).attr("data-image-id",e).text(n.title).appendTo(t)})),this.addEventListenersToList(),this.imageChanged()},n}(x);var st=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const ct=function(t){function n(n){var e=t.call(this,n)||this;return e.button=new it(n),e.key=new et(n),e.list=new at(n),e}return st(n,t),n.prototype.on=function(){this.button.on(),this.key.on(),this.list.on()},n.prototype.off=function(){this.button.off(),this.key.off(),this.list.off()},n}(x);var lt=e(6486),ut=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();const ht=function(t){function n(n){var e=t.call(this,n)||this;return e.wheel=e.wheel.bind(e),e}return ut(n,t),n.prototype.on=function(){this.annotationCanvas.element.addEventListener("wheel",this.wheel)},n.prototype.off=function(){this.annotationCanvas.element.removeEventListener("wheel",this.wheel)},n.prototype.wheel=function(t){if(L(t)&&(0,lt.isFinite)(t.deltaY)){var n=Math.pow(2,.002*-t.deltaY),e=this.annotationCanvas.zoom*n,o=(e-this.annotationCanvas.zoom)/this.annotationCanvas.zoom;this.annotationCanvas.zoom=e;var i=t.pageX*o/this.annotationCanvas.zoom,r=t.pageY*o/this.annotationCanvas.zoom;this.annotationCanvas.scrollX+=i,this.annotationCanvas.scrollY+=r,this.annotationCanvas.render(),E.Z.instance.check(4)}},n}(x),pt=function(){function t(t){this.modulesByMode=new Map,this.annotationCanvas=t;var n=new F(t),e=new I(t),i=new N(t),r=new tt(t),a=new T(t),s=new G(t),c=new Q(t),l=[n,i,r,a],u=[e,r,c],h=[n,s,c];this.modulesByMode.set(o.CURSOR,l),this.modulesByMode.set(o.MARK,u),this.modulesByMode.set(o.GROUP,h),l.concat(u).concat(h).forEach((function(t){return t.off()})),this.mode=o.CURSOR,this.canvasMode||(this.canvasMode=o.CURSOR),this.fullTimeModules=[new ht(t),new ct(t),new k(t)],this.fullTimeModules.forEach((function(t){return t.on()})),this.annotationCanvas.element.addEventListener("selectstart",(function(t){t.preventDefault()}))}return Object.defineProperty(t.prototype,"mode",{set:function(t){this.canvasMode!==t&&(this.off(this.canvasMode),this.on(t),this.canvasMode=t,this.annotationCanvas.render({mode:t}))},enumerable:!1,configurable:!0}),t.prototype.turnOff=function(){this.off(this.canvasMode),this.fullTimeModules.forEach((function(t){return t.off()}))},t.prototype.on=function(t){var n;null===(n=this.modulesByMode.get(t))||void 0===n||n.forEach((function(t){return t.on()}))},t.prototype.off=function(t){var n;null===(n=this.modulesByMode.get(t))||void 0===n||n.forEach((function(t){return t.off()}))},t}(),ft=function(){function t(t,n){t.on("click",this.download.bind(this)),this.dataCallback=n}return t.prototype.download=function(){var t=this.dataCallback(),n=new Blob([this.dataProcessor.processData(t)],{type:this.type}),e=document.createElement("a");e.setAttribute("download",this.dataProcessor.fileName(t)),e.setAttribute("target","blank"),e.setAttribute("href",URL.createObjectURL(n)),e.click()},t}();var dt=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),vt={processData:function(t){var n=[];t.eachObject((function(t){return n.push(t)}));var e=n.map((function(t){var n=t.klass,e=t.centerX,o=t.centerY,i=t.normalWidth,r=t.normalHeight;return[n.id,e.toPrecision(6),o.toPrecision(6),i.toPrecision(6),r.toPrecision(6)]})),o=[];return t.eachRelation((function(t){var e=t.klass,i=t.input,r=t.output;o.push([e.id,n.indexOf(i),n.indexOf(r)])})),e.push([]),e.concat(o).map((function(t){return t.join(" ")})).join("\n")},fileName:function(t){return t.imageTitle}};const yt=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.type="text/plain",n.dataProcessor=vt,n}return dt(n,t),n}(ft),mt=function(t,n){var e=this;this.labelSelect=r()(".object-properties .annotation-label-select").get(0),this.annotationCanvas=t;var o=g.Z.get();R(o,this.labelSelect),this.labelSelect.addEventListener("change",(function(){var i=t.currentPage;if(null==i?void 0:i.selectedObject){var a=o[parseInt(e.labelSelect.value,10)];i.selectedObject.klass=a,r()("".concat(n," .object-name")).html("".concat(a.title," <i>#").concat(i.selectedObject.id,"</i>")),t.render()}})),t.on("selectedObject",(function(){var i=t.currentPage;if(null==i?void 0:i.selectedObject){var a=i.selectedObject.klass;e.labelSelect.value=o.indexOf(a).toString(),r()(n).show(),r()("".concat(n," .object-name")).html("".concat(a.title," <i>#").concat(i.selectedObject.id,"</i>"))}else r()(n).hide()})),r()(n).hide(),r()("".concat(n," .duplicate")).on("click",(function(){var n=t.currentPage;(null==n?void 0:n.selectedObject)&&(n.selectedObject=n.collection.cloneAnnotation(n.selectedObject),t.render(),E.Z.instance.check(14))})),r()("".concat(n," .remove")).on("click",(function(){var n=t.currentPage;(null==n?void 0:n.selectedObject)&&(n.removeAnnotation(n.selectedObject),t.render(),E.Z.instance.check(15))})),r()("".concat(n," .next-annotation")).on("click",(function(){var n=t.currentPage;if(null==n?void 0:n.selectedObject){var o=n.collection.getNextOfTheSameLabel(n.selectedObject);n.selectedObject=o,e.annotationCanvas.scrollX=o.centerPixelX-window.innerWidth/2/t.zoom,e.annotationCanvas.scrollY=o.centerPixelY-window.innerHeight/2/t.zoom,t.render()}})),r()("".concat(n," .previous-annotation")).on("click",(function(){var n=t.currentPage;if(null==n?void 0:n.selectedObject){var o=n.collection.getPreviousOfTheSameLabel(n.selectedObject);n.selectedObject=o,e.annotationCanvas.scrollX=o.centerPixelX-window.innerWidth/2/t.zoom,e.annotationCanvas.scrollY=o.centerPixelY-window.innerHeight/2/t.zoom,t.render()}}))};var wt=e(3311),gt=e.n(wt);const bt=function(){function t(t,n){var e=this;this.canvasControl=t,this.buttons=n,this.activate(this.buttons.first()),this.buttons.on("click",(function(t){e.activate(r()(t.target))}))}return Object.defineProperty(t.prototype,"mode",{set:function(t){var n=gt()(this.buttons,(function(n){return n.classList.contains(t)}));n&&this.activate(r()(n))},enumerable:!1,configurable:!0}),t.prototype.activate=function(t){this.buttons.removeClass("tool-active"),t.addClass("tool-active");var n=gt()(o,(function(n){return t.hasClass(n)}));n&&(this.canvasControl.mode=n,n===o.MARK?E.Z.instance.check(7):n===o.CURSOR?E.Z.instance.check(10):n===o.GROUP&&E.Z.instance.check(16))},t}();var Ct=e(8718),Ot=e.n(Ct),jt=e(3980),_t=e.n(jt),xt=function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},t(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),Pt=function(){return Pt=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},Pt.apply(this,arguments)},kt={processData:function(t){var n=[];t.eachRelation((function(t){n.push(t)}));var e=[];return t.eachObject((function(t){var o=n.filter((function(n){return n.input===t})).map((function(t){return{klass:Ot()(t.klass,["title"]),output:t.output}}));e.push({annotation:Pt(Pt({},t),{normalX:t.normalX+t.normalWidth/2,normalY:t.normalY+t.normalHeight/2,klass:Ot()(t.klass,"title")}),relations:o})})),_t()({annotations:e,relations:H.ac.filter((function(t){return"has_relation"!==t.title})).map((function(t){return Ot()(t,["title"])})),classes:g.Z.get().map((function(t){return Ot()(t,["id","title"])}))})},fileName:function(t){return"".concat(t.imageTitle,".owl")}};const Et=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.type="text/owl",n.dataProcessor=kt,n}return xt(n,t),n}(ft);function Lt(t){t.images.length?r()(".editor").show():r()(".editor").hide()}const St=function(){function t(t,n){var e=this;this.annotationCanvas=new _(n),t.on("pageReload",(function(){e.load()})),this.load(),window.addEventListener("beforeunload",(function(t){t.preventDefault(),t.returnValue=""}))}return Object.defineProperty(t.prototype,"images",{set:function(t){this.annotationCanvas.images=c()(t,"title"),Lt(this.annotationCanvas)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"annotations",{set:function(t){this.annotationCanvas.annotations=t},enumerable:!1,configurable:!0}),t.prototype.render=function(){this.annotationCanvas.render()},Object.defineProperty(t.prototype,"canvas",{get:function(){return this.annotationCanvas},enumerable:!1,configurable:!0}),t.prototype.load=function(){var t=this;Lt(this.annotationCanvas),this.canvasControl&&this.canvasControl.turnOff(),this.canvasControl=new pt(this.annotationCanvas);var n=new bt(this.canvasControl,r()(".tool-buttons > button"));new mt(this.annotationCanvas,".object-properties"),this.annotationCanvas.element.addEventListener("keydown",(function(t){"c"===t.key?n.mode=o.CURSOR:"w"===t.key?n.mode=o.MARK:"g"===t.key?n.mode=o.GROUP:"s"===t.key&&t.ctrlKey&&(r()(".download-annotations").trigger("click"),t.preventDefault())})),r()(".clear").on("click",(function(){window.confirm(a.ZP.t("clear_annotations_from_current_image_confirm"))&&(t.annotationCanvas.currentPage.clear(),t.annotationCanvas.render())})),new yt(r()(".download-yolo-annotations"),(function(){var n=t.annotationCanvas.currentPage;return E.Z.instance.check(20),n.collection})),new Et(r()(".download-owl-annotations"),(function(){var n=t.annotationCanvas.currentPage;return E.Z.instance.check(20),n.collection}))},t}()}}]);